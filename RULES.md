# 揭棋（暗棋/半棋）规则

揭棋是中国象棋的变体，增加了暗子和揭子机制，增加了博弈的不确定性。

---

## 1. 开局设置

### 1.1 棋盘
- 10x9格棋盘（与象棋相同）
- 河界在第4-5行之间
- 坐标：行0-9（0=红方底线，9=黑方底线），列a-i（左到右）

### 1.2 棋子
每方16个棋子：将/帅×1、车×2、马×2、炮×2、象/相×2、士/仕×2、兵/卒×5

### 1.3 开局布局
- **将/帅**：明子，放在e0（红）和e9（黑）
- **其他15个棋子**：暗子（背面朝上），随机分配真实身份后放在对应位置

**标准位置**：
- 车：a0/i0, a9/i9
- 马：b0/h0, b9/h9  
- 象：c0/g0, c9/g9
- 士：d0/f0, d9/f9
- 炮：b2/h2, b7/h7
- 兵：a3/c3/e3/g3/i3, a6/c6/e6/g6/i6

---

## 2. 暗子机制

### 2.1 暗子的走法
暗子**按位置对应的棋子类型**移动，而非真实身份。

**例**：a0位置（车位）的暗子，即使实际是炮，也按车的规则走。

### 2.2 揭子规则
暗子第一次移动时为"揭子走法"：

1. **移动**：按位置对应的棋子类型移动到目标
2. **揭开**：到达后翻开，显示真实身份
3. **之后**：按真实身份移动

**例**：a0位置暗子（车位，实际是炮）
- 第1步：按车走到a5 → 揭开是炮
- 第2步：按炮的规则移动

### 2.3 揭子可以吃子
揭子走法可以吃对方棋子（明子或暗子），吃子后揭开自己。

---

## 3. 明子规则

- 按**真实类型**移动
- **象/士可以过河**（与象棋不同）

---

## 4. 吃子规则

### 4.1 基本规则（象棋规则）
- **车**：直线，吃沿路第一个敌子
- **马**：日字，有马腿限制
- **炮**：必须隔**恰好1个**棋子（炮架）才能吃
- **象**：田字，有象眼限制（明子可过河）
- **士**：斜线，九宫内（明子可过河）
- **兵**：未过河只能前进，过河后可左右
- **将**：九宫内上下左右一格

### 4.2 暗子与炮架
**暗子可以作为炮架**

炮架可以是**任意方**的棋子（明子或暗子）。

**例**：e2红炮 - e3红兵暗子 - e6黑兵暗子
- 红炮可隔e3（己方暗子）打e6 ✓
- 不能打更远（隔了2个子）✗

### 4.3 被吃暗子的信息
- **吃子方**：知道被吃暗子的真实身份
- **被吃方**：不知道

---

## 5. 胜负规则

### 5.1 将军
对方的将被攻击 = 将军

### 5.2 飞将
两将同列且中间无棋子时，后手的将可直接"飞"过去吃对方。

**例**：e0红将 - e1~e8空 - e9黑将  
→ 黑方可走 e9e0（飞将吃红将）

### 5.3 胜负判定
- **胜利**：吃掉对方的将，或对方将死
- **失败**：己方的将被吃，或己方将死
- **将死**：被将军且无合法走法，系统检测到将死立即结束游戏

---

## 6. FEN表示法

格式：`<棋盘> <被吃子> <回合> <视角>`

### 6.1 棋盘符号
- **明子**：K/k(将)、R/r(车)、H/h(马)、C/c(炮)、E/e(象)、A/a(士)、P/p(兵)
  - 大写=红方，小写=黑方
- **暗子**：X(红)、x(黑)
- **空格**：数字1-9

### 6.2 被吃子符号
- 大写（R）：明子被吃，双方都知道
- 小写（r）：暗子被吃，我知道（我吃的）
- 问号（?）：暗子被吃，我不知道

### 6.3 走法表示
- 明子：`a0a1`
- 揭子：`+a0a1`
- 揭子后：`+a0a1=R`（揭出是车）

### 6.4 示例

**开局**：
```
xxxxkxxxx/9/1x5x1/x1x1x1x1x/9/9/X1X1X1X1X/1X5X1/9/XXXXKXXXX -:- r r
         ↑ 黑将           ↑ 红将（都是明子）
```

**中局（红方视角）**：
```
4k4/9/3R5/x1x3x1x/4X4/4x4/X1X3X1X/1C5C1/9/4K4 RP??:raHC r r

被吃子解读：
- 红方被吃：R(车明子) P(兵明子) ??(两个暗子，红方不知)
- 黑方被吃：r(暗车) a(暗士) - 小写=红方吃的，红方知道
            H(马明子) C(炮明子) - 大写=双方都知道
```

---

## 7. 走棋流程

1. **选择己方棋子**（明子或暗子）
2. **确定目标位置**：
   - 暗子：按位置类型的走法
   - 明子：按真实类型的走法
3. **移动**：
   - 可以吃掉目标位置的敌子
   - 暗子移动后立即揭开
4. **检查己方是否被将军**：
   - 走完后不能让己方将被将军
   - 否则该走法非法
5. **切换回合**

---

## 附录：规则要点

| 特性 | 象棋 | 揭棋 |
|------|------|------|
| 象过河 | ✗ | ✓（明子） |
| 士过河 | ✗ | ✓（明子） |
| 暗子 | 无 | 有，按位置类型走 |
| 揭子 | 无 | 第一次移动揭开 |
| 炮架 | 任何子 | 包括暗子 |
| 信息对称 | 完全对称 | 不对称（暗子） |
