# Verbose 输出格式设计

## 概述

每一步棋的详细输出格式，用于调试和分析 AI 对战。

## 格式

```
#{步数} {颜色} {AI名称}
    IN:  {输入FEN}
    {走法} {第几个}/{总数}  score={分数}  {耗时}ms  nodes={节点数} nps={每秒节点} [揭:{揭子}] [吃:{吃子}]
    {棋盘}
    [红吃: {红方吃的}  黑吃: {黑方吃的}]
    FEN: {走后FEN}
```

## 字段说明

| 字段 | 说明 | 示例 |
|------|------|------|
| {步数} | 第几步，从1开始 | `#3` |
| {颜色} | `red` 或 `black` | `red` |
| {AI名称} | 策略名称 | `muses` |
| {输入FEN} | AI 收到的 FEN（当前方视角） | `xxxxkxxxx/9/... r r` |
| {走法} | `+` 前缀表示揭子 | `+b2b9` 或 `e2e5` |
| {第几个}/{总数} | 从 top-N 中选的第几个 | `1/20` |
| {分数} | 下棋前 AI 对这步的评估分数 | `28.6` |
| {耗时} | AI 思考时间（毫秒） | `103` |
| {节点数} | AI 搜索的节点总数 | `116,450` |
| {每秒节点} | 每秒搜索节点数 (NPS) | `1,089,606` |
| {揭子} | 揭开自己的棋子（仅揭子时显示） | `揭:車` |
| {吃子} | 吃掉对方的棋子 | `吃:车` 或 `吃:暗车` |
| {红方吃的} | 红方累计吃掉的黑子 | `仕仕马马` |
| {黑方吃的} | 黑方累计吃掉的红子 | `兵兵` |
| {走后FEN} | 走完后的 FEN | `1Rxxkxxxx/... b b` |

## 吃子显示规则

- **吃明子**：`吃:车` - 对方棋子本来就是明的
- **吃暗子**：`吃:暗车` - 对方棋子是暗的，吃掉后揭开

### 颜色区分

- **红方棋子**：红色显示（車馬象士帥炮兵）
- **黑方棋子**：蓝色显示（车马相仕将砲卒）

使用 rich 库实现终端颜色：
- `[red]車[/red]` - 红方
- `[blue]车[/blue]` - 黑方

## 示例

### 揭子 + 吃暗子
```
#  3 red   muses
    IN:  1xxxkxxxx/h8/1x5x1/x1x1x1x1x/9/9/X1X1X1X1X/1X5X1/P8/1XXXKXXXX -:- r r
    +b2b9    1/20  score=    6.4    107ms 揭:車 吃:暗仕
    a   b   c   d   e   f   g   h   i
 9  ·   車  暗  暗  将  暗  暗  暗  暗
 8  马  ·   ·   ·   ·   ·   ·   ·   ·
 ...
    红吃: 仕仕
    FEN: 1Rxxkxxxx/h8/.../1XXXKXXXX -:aa r r
```

### 普通走法（无揭子无吃子）
```
#  5 red   muses
    IN:  ...
    e2e5     1/20  score=   98.0     95ms
    {棋盘}
    FEN: ...
```

### 吃明子
```
#  7 black iterative
    IN:  ...
    h3e3     2/20  score= -112.0    102ms 吃:兵
    {棋盘}
    黑吃: 兵兵
    FEN: ...
```

## FEN 视角规则

- **{输入FEN}** 和 **{走后FEN}** 都是当前走棋方的视角
- 奇数步（红方走）→ 红方视角
- 偶数步（黑方走）→ 黑方视角

## 可选字段

以下字段只在有意义时显示：

| 字段 | 显示条件 |
|------|----------|
| `揭:{揭子}` | 仅揭子走法时显示 |
| `吃:{吃子}` | 仅吃子时显示 |
| `红吃: ...` | 红方有吃子时显示 |
| `黑吃: ...` | 黑方有吃子时显示 |
